!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){var o=n(3),r=n(4),i=n(5);t.exports=function(t){return o(t)||r(t)||i()}},function(t,e,n){t.exports=n(2)},function(t,e,n){"use strict";n.r(e);var o=n(0),r=n.n(o),i={sheet:{width:250,height:210},parts:[{name:"square",points:[20,20,20,-20,-20,-20,-20,20,20,20],num:0},{name:"rectangle",points:[20,10,20,-10,-20,-10,-20,10,20,10],num:0},{name:"echelo1",points:[20,20,40,-20,-40,-20,-20,20,20,20],num:0},{name:"echelo2",points:[20,20,20,-20,-40,-20,-20,20,20,20],num:0}]},a=(document.querySelectorAll('input[type="text"]'),document.getElementById("btn")),h=document.getElementById("btn2"),u=document.getElementById("square"),l=document.getElementById("rectangle"),c=document.getElementById("echelo1"),d=document.getElementById("echelo2"),s=document.getElementById("width"),f=document.getElementById("height"),g=document.getElementById("allutil"),m={container:"container",width:1e3,height:550,iw:400,left:0,top:50,font:30},p=new Konva.Stage({container:m.container,width:m.width,height:m.height}),v=new Konva.Layer,y=new Konva.Group;function w(t,e){return parseInt(Math.random()*(e-t)+1)+t}function b(t){y.destroyChildren();var e=t.map(function(t){return Array(t.num>20?20:t.num).fill(t)}),n=[];e.forEach(function(t){n.push.apply(n,r()(t))}),n.forEach(function(t,e){var n=t.points,o=function(t,e){var n=0,o=0,r=0,i=0;return e+=1,t.forEach(function(t,e){e%2==0?(n=Math.max(t,n),r=Math.min(t,r)):(o=Math.max(t,o),i=Math.min(t,i))}),{width:[-r+e,m.width-n-e],height:[-i+e,m.height-o-e]}}(n,1),r=new Konva.Line({x:w(o.width[0],o.width[1]),y:w(o.height[0],o.height[1]),minx:o.width[0],miny:o.height[0],points:n,fill:"#8498d1",stroke:"#617bb5",strokeWidth:1,closed:!0});(function(t,e,n){var o=e.getClientRect(),r=n.width,i=n.height;if(0===t.children.length)return e.setAttrs({width:o.width,height:o.height}),!0;var a=[];t.children.each(function(t){a.push(t.attrs)});for(var h=0,u=0,l=e.attrs.x,c=e.attrs.y;u<a.length;){if(++h>=1e4)return console.log("终止循环"),!1;l-r[0]>a[u].x+a[u].width-a[u].minx||l+o.width-r[0]<a[u].x-a[u].minx||c-i[0]>a[u].y+a[u].height-a[u].miny||c+o.height-i[0]<a[u].y-a[u].miny?u++:(l=w(r[0],r[1]),c=w(i[0],i[1]),u=0)}return e.setAttrs({x:l,y:c,width:o.width,height:o.height}),!0})(y,r,o)&&y.add(r)}),v.draw()}p.add(v),v.add(y),control.addEventListener("focus",function(t){var e=t.target.id;"square"!==e&&"rectangle"!==e&&"echelo1"!==e&&"echelo2"!==e&&"width"!==e&&"height"!==e||(console.log(t.target.value),t.target.value="")},{capture:!0}),width.addEventListener("change",function(t){t.target.value>1e3&&(t.target.value="1000")}),height.addEventListener("change",function(t){t.target.value>550&&(t.target.value="550")}),a.addEventListener("click",function(){var t={square:u.value,rectangle:l.value,echelo1:c.value,echelo2:d.value,width:s.value,height:f.value};i.parts.forEach(function(e){console.log(e),e.num=Number(t[e.name])}),i.sheet.width=Number(t.width),i.sheet.height=Number(t.height),b(i.parts),console.log(i.parts)}),h.addEventListener("click",function(){console.log(i),axios.post("http://192.168.1.136:8000/nest",{json:i}).then(function(t){console.log(t.data);var e=(100*t.data.allutil.toFixed(4)).toString().substr(0,5)+"%";g.value=e,function(t){y.destroyChildren();var e=Math.floor(m.width/m.iw),n=Math.round(t.length/e),o=(m.width-m.iw*e)/(e+1),r=i.sheet.width/i.sheet.height,a=m.iw,h=m.iw/r,u=n*h+(n+1)*m.top;u>m.height&&p.size({width:m.width,height:u}),m.left=o,t.forEach(function(t,n){var o=Math.floor(n/e),r=m.left*(n%e+1)+a*(n%e),i=m.top*(o+1)+h*o,u="".concat(t.name,"-利用率:").concat((100*t.util.toFixed(4)).toString().substr(0,5),"%");console.log(m.font*u.length);var l=new Konva.Text({x:r+10,y:i-30,text:u,fontSize:m.font,fontFamily:"Calibri",fill:"green"}),c=new Konva.Rect({x:r,y:i,width:a,height:h,stroke:"#617bb5"});y.add(c,l),t.parts.forEach(function(e,n){var o=new Konva.Line({x:r,y:i,points:e.points,fill:"#8498d1",stroke:"#617bb5",strokeWidth:1,closed:!0});o.scale({x:a/t.width,y:h/t.height}),y.add(o)})}),v.draw()}(t.data.Sheets)}).catch(function(t){console.log(t)})})},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}}]);